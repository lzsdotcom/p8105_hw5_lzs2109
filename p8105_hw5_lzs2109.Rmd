---
title: "Data Science I Homework 5 - lzs2109"
author: "Louis Sharp"
date: "11/11/2021"
output: github_document
---

```{r}
library(tidyverse)
```


### **Problem 1**

```{r}
homicide_df = read_csv("./data/homicide-data.csv") %>% 
  mutate(city_state = str_c(city, state, sep = ", "),
         status = ifelse(disposition == "Closed by arrest", "solved", "unsolved"))
```

The raw data from homicide-data.csv contains the variables `r names(homicide_df)`, which give ID numbers to each homicide, in addition to the date, victim's information, the location (city, state, and specific latitude/longitude) of the homicide, and finally the status of the case (closed/open/arrest/no arrest). There are 51 cities and a total of `r nrow(homicide_df)` homicides with data included in the dataset.

```{r}
homicide_df %>% 
  group_by(city_state, status) %>% 
  count()

bmore = 
  homicide_df %>%
    filter(city_state == "Baltimore, MD") %>%
    group_by(status) %>% 
    count()
bmore = prop.test(x = bmore$n[2], n = bmore$n[1] + bmore$n[2])
bmore %>% 
  broom::tidy() %>% 
  select(estimate, conf.low, conf.high)
```

```{r}
unsolved_murders = function(location) {
  
  city = homicide_df %>% 
           filter(city_state == location) %>%
           group_by(status) %>% 
           count()
  
  city = prop.test(x = city$n[2], n = city$n[1] + city$n[2])
  
  city %>% 
    broom::tidy() %>% 
    select(estimate, conf.low, conf.high)
  
}

unsolved_murders("Atlanta, GA")
```

```{r}
homicide_df %>% 
  group_by(city_state, status) %>% 
  count()
```


## Problem 2

```{r, message = F, warning = F}
hw5_df = 
  tibble(
  filenames = list.files("data/hw5_data/"),
  location = str_c("./data/hw5_data/", filenames),
  data = map(location, read_csv)
) %>% 
  mutate(filenames = str_remove(filenames, ".csv$")) %>% 
  rename(treatment = filenames) %>% 
  unnest() %>% 
  select(-location) %>% 
  pivot_longer(week_1:week_8, 
               names_to = "week", 
               names_prefix = "week_", 
               values_to = "data_value") %>% 
  mutate(week = as.numeric(week))

hw5_df %>% 
  ggplot(aes(x = week, y = data_value, color = treatment)) +
  geom_line(alpha = 0.6)
```

